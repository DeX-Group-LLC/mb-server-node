# Monitoring Guide

This guide documents all available metrics in MB Server Node, organized by module.

## Process & System Metrics

These metrics track the broker process and system-level resources.

| Metric Name | Type | Description |
|------------|------|-------------|
| `process.cpu.percent` | Percent | CPU usage percentage for the broker process |
| `process.memory.bytes` | Gauge | Memory usage in bytes for the broker process |
| `process.memory.percent` | Percent | Memory usage percentage for the broker process |
| `process.uptime` | Uptime | Broker process uptime in seconds |
| `system.cpu.percent` | Percent | Overall CPU usage percentage |
| `system.cpu.{core}.percent` | Percent | CPU usage percentage per core |
| `system.memory.bytes` | Gauge | Total system memory usage in bytes |
| `system.memory.percent` | Percent | Total system memory usage percentage |
| `system.uptime` | Uptime | System uptime in seconds |

## Registry Metrics

These metrics track service registration and discovery operations.

| Metric Name | Type | Description |
|------------|------|-------------|
| `registry.count` | Gauge | Total number of registered services |
| `registry.discovery.rate` | Rate | Rate of service discovery requests per second |
| `registry.registration.rate` | Rate | Rate of service registrations per second |
| `registry.unregistration.rate` | Rate | Rate of service unregistrations per second |
| `registry.service.{serviceid}.error.rate` | Rate | Rate of errors generated by a specific service |
| `registry.service.{serviceid}.uptime` | Uptime | Uptime of a specific service in seconds |

## Router Metrics

These metrics track message routing and processing.

| Metric Name | Type | Description |
|------------|------|-------------|
| `router.message.count` | Gauge | Total messages processed |
| `router.message.rate` | Rate | Messages processed per second |
| `router.message.count.error` | Gauge | Total message errors |
| `router.message.rate.error` | Rate | Message errors per second |
| `router.message.size.avg` | Average | Average message size in bytes |
| `router.message.size.max` | Maximum | Maximum message size in bytes |

### Publish Operations

| Metric Name | Type | Description |
|------------|------|-------------|
| `router.publish.count` | Gauge | Total publish messages |
| `router.publish.count.dropped` | Gauge | Total dropped publish messages |
| `router.publish.count.error` | Gauge | Total publish errors |
| `router.publish.rate` | Rate | Publish messages per second |
| `router.publish.rate.dropped` | Rate | Dropped publish messages per second |
| `router.publish.rate.error` | Rate | Publish errors per second |

### Request/Response Operations

| Metric Name | Type | Description |
|------------|------|-------------|
| `router.request.count` | Gauge | Total request messages |
| `router.request.count.dropped` | Gauge | Total dropped requests |
| `router.request.count.error` | Gauge | Total request errors |
| `router.request.count.timeout` | Gauge | Total request timeouts |
| `router.request.rate` | Rate | Requests per second |
| `router.request.rate.dropped` | Rate | Dropped requests per second |
| `router.request.rate.error` | Rate | Request errors per second |
| `router.request.rate.timeout` | Rate | Request timeouts per second |
| `router.response.count` | Gauge | Total response messages |
| `router.response.count.error` | Gauge | Total response errors |

## Metric Types

The following metric types are available:

- **Gauge**: A simple value that can be set directly
- **Rate**: A value measured per second, automatically reset each second
- **Percent**: A value between 0 and 100
- **Uptime**: Duration in seconds since a specific event
- **Average**: Running average of values
- **Maximum**: Highest value seen

## Using Metrics

### Querying Metrics

To query metrics, send a request to the `system.metrics` topic:

```javascript
{
    "showAll": true,           // Optional, show all metric details
    "paramFilter": {           // Optional, filter parameterized metrics
        "serviceId": "123"     // Example: only show metrics for service 123
    }
}
```

### Response Format

The response includes the metric values and optionally their types and timestamps:

```javascript
{
    "metrics": {
        "process.cpu.percent": 12.5,
        "registry.count": 5,
        // ... more metrics ...
    }
}
```

With `showAll: true`:
```javascript
{
    "metrics": {
        "process.cpu.percent": {
            "name": "process.cpu.percent",
            "type": "percent",
            "timestamp": "2024-01-20T12:00:00.000Z",
            "value": 12.5
        },
        // ... more metrics ...
    }
}
```
